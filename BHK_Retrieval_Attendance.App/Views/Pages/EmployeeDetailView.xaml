<UserControl x:Class="BHK.Retrieval.Attendance.WPF.Views.Pages.EmployeeDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Background="{DynamicResource MaterialDesignPaper}">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal">
                    <Button Command="{Binding BackCommand}"
                            Style="{StaticResource MaterialDesignIconButton}"
                            VerticalAlignment="Top">
                        <materialDesign:PackIcon Kind="ArrowLeft"/>
                    </Button>
                    
                    <StackPanel Margin="10,0,0,0">
                        <TextBlock Text="Thông tin chi tiết nhân viên"
                                   FontSize="24"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource MaterialDesignBody}"/>
                        <TextBlock Text="{Binding Employee.UserName, StringFormat='Dữ liệu của nhân viên: {0}'}"
                                   FontSize="14"
                                   Foreground="{DynamicResource MaterialDesignBodyLight}"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>

            <!-- Loading Indicator -->
            <materialDesign:Card Grid.Row="1" 
                                Padding="40"
                                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Margin="0,0,0,20">
                <StackPanel HorizontalAlignment="Center">
                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                IsIndeterminate="True"
                                Width="50"
                                Height="50"/>
                    <TextBlock Text="Đang tải dữ liệu nhân viên..."
                               Margin="0,20,0,0"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Employee Basic Info -->
            <materialDesign:Card Grid.Row="1" 
                                Padding="20" 
                                Margin="0,0,0,20"
                                Visibility="{Binding HasEmployeeData, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Section Header -->
                    <StackPanel Grid.Row="0" 
                               Orientation="Horizontal" 
                               Margin="0,0,0,15">
                        <materialDesign:PackIcon Kind="Account" 
                                               Width="24" 
                                               Height="24"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource MaterialDesignBody}"
                                               Margin="0,0,10,0"/>
                        <TextBlock Text="Thông tin cá nhân"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Basic Info Grid -->
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="250"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Row 1 -->
                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Text="ID nhân viên:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" 
                                   Text="{Binding Employee.DIN}" 
                                   Margin="0,0,0,10"/>
                        
                        <TextBlock Grid.Row="0" Grid.Column="2" 
                                   Text="Họ và tên:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" 
                                   Text="{Binding Employee.UserName}" 
                                   Margin="0,0,0,10"/>

                        <!-- Row 2 -->
                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Text="CMND/CCCD:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" 
                                   Text="{Binding Employee.IDNumber}" 
                                   Margin="0,0,0,10"/>
                        
                        <TextBlock Grid.Row="1" Grid.Column="2" 
                                   Text="Giới tính:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="1" Grid.Column="3" 
                                   Text="{Binding Employee.Sex, Converter={StaticResource GenderConverter}}" 
                                   Margin="0,0,0,10"/>

                        <!-- Row 3 -->
                        <TextBlock Grid.Row="2" Grid.Column="0" 
                                   Text="Phòng ban:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="2" Grid.Column="1" 
                                   Text="{Binding Employee.DepartmentName}" 
                                   Margin="0,0,0,10"/>
                        
                        <TextBlock Grid.Row="2" Grid.Column="2" 
                                   Text="Trạng thái:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <StackPanel Grid.Row="2" Grid.Column="3" 
                                   Orientation="Horizontal" 
                                   Margin="0,0,0,10">
                            <Ellipse Width="8" Height="8" 
                                    Fill="{Binding Employee.Enable, Converter={StaticResource BooleanToColorConverter}}"
                                    VerticalAlignment="Center"
                                    Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding Employee.Enable, Converter={StaticResource BooleanToStatusConverter}}"
                                      VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Row 4 -->
                        <TextBlock Grid.Row="3" Grid.Column="0" 
                                   Text="Ca làm việc:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="3" Grid.Column="1" 
                                   Text="{Binding Employee.AttType}" 
                                   Margin="0,0,0,10"/>
                        
                        <TextBlock Grid.Row="3" Grid.Column="2" 
                                   Text="Quyền hạn:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="3" Grid.Column="3" 
                                   Text="{Binding Employee.Privilege, Converter={StaticResource PrivilegeConverter}}" 
                                   Margin="0,0,0,10"/>

                        <!-- Row 5 - Comment -->
                        <TextBlock Grid.Row="4" Grid.Column="0" 
                                   Text="Ghi chú:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="4" Grid.Column="1" 
                                   Grid.ColumnSpan="3"
                                   Text="{Binding Employee.Comment}" 
                                   TextWrapping="Wrap"
                                   Margin="0,0,0,10"/>
                    </Grid>
                </Grid>
            </materialDesign:Card>

            <!-- Enrollment Info -->
            <materialDesign:Card Grid.Row="2" 
                                Padding="20" 
                                Margin="0,0,0,20"
                                Visibility="{Binding HasEmployeeData, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Section Header -->
                    <StackPanel Grid.Row="0" 
                               Orientation="Horizontal" 
                               Margin="0,0,0,15">
                        <materialDesign:PackIcon Kind="Fingerprint" 
                                               Width="24" 
                                               Height="24"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource MaterialDesignBody}"
                                               Margin="0,0,10,0"/>
                        <TextBlock Text="Thông tin đăng ký"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Enrollment Grid -->
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="250"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Text="Mật khẩu:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" 
                                   Text="{Binding PasswordStatus}" 
                                   Margin="0,0,0,10"/>

                        <TextBlock Grid.Row="0" Grid.Column="2" 
                                   Text="Thẻ từ:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" 
                                   Text="{Binding CardStatus}" 
                                   Margin="0,0,0,10"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Text="Vân tay:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" 
                                   Text="{Binding FingerprintStatus}" 
                                   Margin="0,0,0,10"/>

                        <TextBlock Grid.Row="1" Grid.Column="2" 
                                   Text="Số ID thẻ:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="1" Grid.Column="3" 
                                   Text="{Binding Employee.CardID}" 
                                   Margin="0,0,0,10"/>
                    </Grid>
                </Grid>
            </materialDesign:Card>

            <!-- Access Control -->
            <materialDesign:Card Grid.Row="3" 
                                Padding="20" 
                                Margin="0,0,0,20"
                                Visibility="{Binding HasEmployeeData, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Section Header -->
                    <StackPanel Grid.Row="0" 
                               Orientation="Horizontal" 
                               Margin="0,0,0,15">
                        <materialDesign:PackIcon Kind="Security" 
                                               Width="24" 
                                               Height="24"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource MaterialDesignBody}"
                                               Margin="0,0,10,0"/>
                        <TextBlock Text="Kiểm soát truy cập"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Access Control Grid -->
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="250"/>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Row="0" Grid.Column="0" 
                                   Text="Vùng thời gian:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" 
                                   Text="{Binding Employee.AccessTimeZone}" 
                                   Margin="0,0,0,10"/>

                        <TextBlock Grid.Row="0" Grid.Column="2" 
                                   Text="Hiệu lực từ:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="0" Grid.Column="3" 
                                   Text="{Binding Employee.ValidDate, StringFormat='dd/MM/yyyy'}" 
                                   Margin="0,0,0,10"/>

                        <TextBlock Grid.Row="1" Grid.Column="0" 
                                   Text="Kiểm soát khóa:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" 
                                   Text="{Binding Employee.AccessControl, Converter={StaticResource AccessControlConverter}}" 
                                   Margin="0,0,0,10"/>

                        <TextBlock Grid.Row="1" Grid.Column="2" 
                                   Text="Hiệu lực đến:" 
                                   FontWeight="Medium" 
                                   Margin="0,0,0,10"/>
                        <TextBlock Grid.Row="1" Grid.Column="3" 
                                   Text="{Binding Employee.InvalidDate, StringFormat='dd/MM/yyyy'}" 
                                   Margin="0,0,0,10"/>
                    </Grid>
                </Grid>
            </materialDesign:Card>

            <!-- Recent Attendance Records -->
            <materialDesign:Card Grid.Row="4" 
                                Padding="20"
                                Visibility="{Binding HasEmployeeData, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Section Header -->
                    <StackPanel Grid.Row="0" 
                               Orientation="Horizontal" 
                               Margin="0,0,0,15">
                        <materialDesign:PackIcon Kind="ClockOutline" 
                                               Width="24" 
                                               Height="24"
                                               VerticalAlignment="Center"
                                               Foreground="{DynamicResource MaterialDesignBody}"
                                               Margin="0,0,10,0"/>
                        <TextBlock Text="Lịch sử chấm công gần đây"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                        
                        <Button Command="{Binding RefreshAttendanceCommand}"
                                Style="{StaticResource MaterialDesignIconButton}"
                                ToolTip="Làm mới dữ liệu"
                                Margin="20,0,0,0">
                            <materialDesign:PackIcon Kind="Refresh"/>
                        </Button>
                    </StackPanel>

                    <!-- Attendance Records -->
                    <DataGrid Grid.Row="1"
                              ItemsSource="{Binding AttendanceRecords}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserReorderColumns="False"
                              CanUserResizeColumns="True"
                              CanUserSortColumns="True"
                              IsReadOnly="True"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              MaxHeight="300"
                              Style="{StaticResource MaterialDesignDataGrid}">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Thời gian"
                                              Binding="{Binding Clock, StringFormat='dd/MM/yyyy HH:mm:ss'}"
                                              Width="140"/>

                            <DataGridTextColumn Header="Loại"
                                              Binding="{Binding Action, Converter={StaticResource AttendanceActionConverter}}"
                                              Width="100"/>

                            <DataGridTextColumn Header="Phương thức"
                                              Binding="{Binding Verify, Converter={StaticResource VerifyMethodConverter}}"
                                              Width="120"/>

                            <DataGridTextColumn Header="Thiết bị"
                                              Binding="{Binding DN}"
                                              Width="80"/>

                            <DataGridTextColumn Header="Ghi chú"
                                              Binding="{Binding Remark}"
                                              Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </materialDesign:Card>

            <!-- Action Buttons -->
            <StackPanel Grid.Row="4" 
                       Orientation="Horizontal" 
                       HorizontalAlignment="Right"
                       Margin="0,20,0,0"
                       Visibility="{Binding HasEmployeeData, Converter={StaticResource BooleanToVisibilityConverter}}">

                <Button Content="Làm mới dữ liệu"
                        Command="{Binding RefreshDataCommand}"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Margin="0,0,10,0">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Refresh" 
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,5,0"/>
                            <TextBlock Text="Làm mới" 
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button.Content>
                </Button>

                <Button Content="Xuất báo cáo"
                        Command="{Binding ExportReportCommand}"
                        Style="{StaticResource MaterialDesignRaisedButton}">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FileExport" 
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,5,0"/>
                            <TextBlock Text="Xuất báo cáo" 
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button.Content>
                </Button>
            </StackPanel>
        </Grid>
    </ScrollViewer>
</UserControl>